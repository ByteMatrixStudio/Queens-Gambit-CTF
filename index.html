<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Q</title>

  <link rel="stylesheet" href="./assets/vendor/chessboardjs-1.0.0/css/chessboard-1.0.0.min.css">

  <style>
    body{margin:0;min-height:100vh;background:#0b0f14;color:#e6edf3;font-family:Arial,sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px}
    h1{margin:0;font-size:48px;letter-spacing:1px}
    #b{width:780px;max-width:92vw}
    .w{padding:28px;border-radius:16px;background:rgba(255,255,255,.04);box-shadow:0 10px 30px rgba(0,0,0,.45);width:fit-content}
    #s{margin-top:14px;font-size:18px;opacity:.95;max-width:780px;line-height:1.35}
    #x{display:none;padding:28px;border-radius:16px;background:rgba(255,255,255,.04);box-shadow:0 10px 30px rgba(0,0,0,.45);width:min(1000px,92vw);text-align:center;opacity:0;transform:translateY(8px);transition:opacity 250ms ease,transform 250ms ease}
    #x.k{opacity:1;transform:translateY(0)}
    #x h2{margin:0 0 10px 0;font-size:42px;letter-spacing:1px}
    #x p{margin:0 0 18px 0;opacity:.9;font-size:18px}
    #r{margin-top:18px;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:#e6edf3;cursor:pointer;font-size:16px}
    #r:hover{background:rgba(255,255,255,.10)}
  </style>
</head>

<body>
  <div class="w" id="g">
    <h1>Chess Board</h1>
    <div id="b"></div>
    <div id="s"></div>
  </div>

  <div id="x">
    <h2>OK</h2>
    <p id="z"></p>
    <div><button id="r" type="button">Restart</button></div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <script src="./assets/vendor/chessboardjs-1.0.0/js/chessboard-1.0.0.min.js"></script>

  <script>
    const A=[[[128,171,15,234],[159,81,76,49]],[[172,200,44,73],[181,50,105,145]],[[117,83,105,208],[111,165,4,134]],[[177,220,72,56],[158,187,191,35]],[[175,39,220,204],[10,102,55,97]],[[94,156,188,185],[111,171,190,219]],[[77,178,222,171],[53,95,67,242]],[[191,216,30,190],[126,84,70,52]],[[16,17,127,14],[206,207,128,25]],[[36,105,151,106],[60,149,211,179]]];
    const B=[209,46,57,92,51,108,52,202,214,194,85,145,191,119,32,16,35,238,24,234,244,198,192,53,36,37,47,215,67,166,137,240,52,158,183,14,235,211,190,123];

    const C=[
      "The center is the heart of the board. Start there.",
      "A familiar pawn offer can steer the game into classic territory…",
      "Develop a knight. Nothing fancy yet.",
      "Bring another piece out. Keep it principled.",
      "Open a lane without overcommitting.",
      "A quiet bishop move. Keep options.",
      "King safety matters. Don’t be greedy.",
      "A queen reposition — not an attack yet.",
      "A central queen step. Calm, not flashy.",
      "One more queen step. A clean landing."
    ];

    const D=[
      "That doesn’t fit the theme. Think classical.",
      "Close, but the idea is more principled.",
      "Not quite. Try something more central.",
      "The plan is simpler than it looks."
    ];

    const E=document.getElementById("g");
    const F=document.getElementById("x");
    const G=document.getElementById("r");
    const H=document.getElementById("s");
    const I=document.getElementById("z");

    const J=(u)=>{u|=0;u^=u<<13;u^=u>>>17;u^=u<<5;return u>>>0};
    const K=(i,w)=>((0x00C0FFEE^(((i+1)*0x9E3779B9)>>>0)^(w?0xA5A5A5A5:0x5A5A5A5A))>>>0);
    const L=(a,seed)=>{let u=seed>>>0,o="";for(let i=0;i<a.length;i++){u=J(u);o+=String.fromCharCode((a[i]^ (u&255))&255)}return o};

    function M(t){H.textContent=t}

    function N(){
      I.textContent=L(B,0xDEADBEEF);
      E.style.display="none";
      F.style.display="block";
      requestAnimationFrame(()=>F.classList.add("k"));
    }

    function O(){
      F.classList.remove("k");
      F.style.display="none";
      E.style.display="block";
    }

    function P(u){return{from:u.slice(0,2),to:u.slice(2,4),promotion:"q"}}

    function Q(q){
      const v=R.get(q);
      return !!v && v.color==="w" && v.type==="q";
    }

    function S(i){return D[i%D.length]}

    var R,T;
    var U=0;

    function V(){T.position(R.fen())}
    function W(){M("White to move. "+(C[U]||"Continue the idea…"))}

    function X(){
      R=new Chess();
      U=0;
      O();

      if(T){T.position("start")}
      else{
        T=Chessboard("b",{
          draggable:true,
          position:"start",
          pieceTheme:"./assets/vendor/chessboardjs-1.0.0/img/chesspieces/wikipedia/{piece}.png",
          onDragStart:function(src,p){
            if(p.startsWith("b"))return false;
            if(R.turn()!=="w")return false;
            if(F.style.display==="block")return false;
          },
          onDrop:function(src,dst){
            if(src===dst)return"snapback";
            if(U>=A.length){M("The board is quiet.");return"snapback"}

            const exp=L(A[U][0],K(U,1));
            const uci=src+dst;

            if(uci!==exp){M(S(U));return"snapback"}

            const wm=R.move(P(uci));
            if(wm===null){M("That move isn’t legal.");return"snapback"}
            V();

            if(Q("e5")){N();return}

            const bu=L(A[U][1],K(U,0));
            const bm=R.move(P(bu));
            if(bm===null){M("Black reply failed.");return}

            U++;
            V();

            if(Q("e5")){N();return}

            W();
          }
        });
      }

      W();
    }

    G.addEventListener("click",X);
    X();
  </script>
</body>
</html>
